---
title: "How does education level relate to suicide rate?"
author: "Jiaqi Li and Mackie Zhou"
date: "Last updated on `r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    df_print: kable
---
 

In this section, you will see each state or region's educational attainment distribution and suicide rate.

```{r, message=FALSE, warning=FALSE, echo=FALSE}
# Set R chunk default options:
# -do not output all R messages in html report
# -do not output all R warnings in html report
# -set default figure widths and heights for all code blocks, unless you 
#  override them
knitr::opts_chunk$set(
  message = FALSE, warning = FALSE
)
```

```{r, echo = FALSE}
# load packages
library(tidyverse)
library(sf)
library(maps)
library(USAboundaries)
library(plotly)
library(widgetframe)
library(patchwork)
library(scales)

# read the ecudational attainment df into R
Edu_complete <- read_csv("Estimate_Educational_attainment_2017.csv")

# read the suicide df into R
suicide_by_state <- read_csv("Suicide_Mortality_by_State.csv")

# read the 50 state names&codes df into R
State_names <- read_csv("50State_names_and_codes.csv")

# US_map
US_map<-USAboundaries::us_states(resolution = "high") %>%
  mutate(lon = purrr::map_dbl(geometry, ~sf::st_centroid(.x)[[1]]),
         lat = purrr::map_dbl(geometry, ~sf::st_centroid(.x)[[2]]))

```

# Suicide Death Rate

Suicide is one of the several major causes of death in the US. Suicide death rate varies significantly across the nation. The data of suicide mortality by state is from _National Center for Health Statistics_^[Suicide Mortality by State, https://www.cdc.gov/nchs/pressroom/sosmap/suicide-mortality/suicide.htm], adjusted for differences in age-distribution and population size. From the data, we see that Montana has the highest suicide death rate of 28.9%, while New York has the lowest suicide death rate of 8.1%. The range is __20.8%__.

From the map, we find that the west has higher overall suicide death rate than the east, while a strict geographic trend cannot be observed. Therefore, we want to explore __other factors, including education level, that may account for the various suicide death rates among states__ in the US.

```{r, echo = FALSE}
# select only data in 2017 and optimize the df
suicide_2017 <- suicide_by_state %>% 
  filter(YEAR=="2017") %>% 
  left_join(State_names, by = c("STATE" = "Code")) %>% 
  rename(CODE = STATE,
         STATE = State) %>%
  arrange( RATE ) %>% 
  select(STATE, CODE, DEATHS, RATE)

# horizontal bar graph of suicide rate by state
suicide <- ggplot(data = suicide_2017,
       mapping = aes(x = reorder(STATE, -desc(RATE)),
                     y = RATE)) +
  geom_col(fill="CornflowerBlue",
           width = 0.75) +
  # scale_y_continuous(labels = scales::percent) +
  labs(x = "State",
       y = "Suicide Death Rate(%)",
       title = "Suicide Death Rate by State in 2017") +
  # theme(text = element_text(size=15)) +
  coord_flip()

#Suicide Rate by State map
suicide_map_df<- US_map %>% 
  left_join(suicide_2017, by=c("stusps"="CODE"))

suicide_map <- ggplot()+
  geom_sf(data = suicide_map_df,
          aes(fill = RATE), 
          color = "white") +
  scale_fill_gradient(low = "#86e884", high = "#244024") +
  labs(x = "Longitude", 
       y = "Latitude", 
       fill = "Suicide Death Rate",
       title = "Suicide Rate by State") +
  coord_sf(xlim = c(-170, -60), ylim = c(24, 72), expand = FALSE)

ggplotly(suicide_map) %>%
  widgetframe::frameWidget()

```

# Estimate Educational Attainment

One of the many possible reasons that account for the various suicide death rate is education level. Educational attainment is defined as the highest level of education that an individual has completed. The Estimate Educational Attainment data is from the United States Census Bureau^[ EDUCATIONAL ATTAINMENT 2013-2017 American Community Survey 5-Year Estimates, https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_17_5YR_S1501&prodType=table]. District of Columbia, followed by Massachusetts, has the highest percent(21.8%) of people aged 18-24 holding a bachelor or higher degree; while Nevada has the lowest percent(5.3%). The range is __16.5%__.

Below you can find a stacked bar graph of educational attainment of 52 states and regions in the US. States and regions are in the __descending order__ of percentages of people holding a bachelor or higher degree.


```{r, echo = FALSE, fig.height = 16, fig.width = 9}
# select only the state names and the percentages
Edu_percent <- Edu_complete %>%
  select(State, contains("Percent")) %>% 
  select(-(contains("MOE"))) %>% 
  pivot_longer(names_to = "Education", 
               values_to = "Percentage", 
               cols = -State) %>% 
  mutate(Education = str_replace_all(Education, " - Percent", ""))

Edu_percent <- arrange(Edu_percent, Education, Percentage)
Edu_percent$State <- factor(Edu_percent$State, levels = unique(Edu_percent$State)) 

edu <- ggplot(data = Edu_percent, 
       mapping = aes(x = State,
                     y = Percentage, 
                     fill = factor(Education, 
                                   levels=c("Less than high school graduate",
                                            "High school graduate (includes equivalency)",
                                            "Some college or associate's degree",
                                            "Bachelor's degree or higher")))) +
  geom_bar(position="fill", 
           stat="identity",
           width = 0.7) +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "State",
       y = "Percentage",
       fill = "Educational Attainment",
       title = "Estimate Educational Attainment\nof People Aged 18-24\nby State in 2017") +
  coord_flip() +
  # theme(text = element_text(size=15)) +
  # guides(fill=guide_legend(ncol=1)) +
  guides(fill = guide_legend(reverse=TRUE, ncol=1)) +
  theme(legend.position="bottom")

#Education Attainment Map by State in U.S
edu_map_df<- US_map %>%
  left_join(Edu_complete,by=c("name"="State")) %>%
  filter(stusps != "DC")

edu_map <- ggplot()+
  geom_sf(data = edu_map_df, aes(fill = score), color = "white") +
  scale_fill_gradient(low = "lightblue",
                      high = "#06154f") +
  coord_sf(xlim = c(-170, -60),
           ylim = c(24, 72),
           expand = FALSE) +
  labs(x = "Longitude", 
       y = "Latitude", 
       fill = "Education\nLevel\nScore",
       title = "Education Level Score by State")

layout <- "
  AB
  A#
  A#
  A#
  A#"
  
edu + edu_map +
  plot_layout(design = layout)

```

# Relationship between Suicide Death Rate and Education Level

(The education level raw score is calculated using the equation: score = (less than high school graduate%)^1 + (high school graduate%)^2 + (some college or associate’s degree%)^3 + (bachelor’s degree or higher%)^4. The raw score is then adjusted, with __Massachusetts’ score set to 100__.）

__Education attainment score is negatively correlate with suicide rate__. As indicated by the scatter plot, higher suicide rates are more likely to occur in states where overall education attainment is low.

```{r, echo = FALSE}
edu_score_suicide <- suicide_2017 %>% 
  inner_join(Edu_complete, by = c("STATE" = "State")) %>% 
  select(-Id, -Id2) %>% 
  rename(Death_Rate100 = RATE, Education_Level = score) %>% 
  mutate(Death_Rate = Death_Rate100/100) %>% 
  select(STATE, Death_Rate, Education_Level, everything())

scatter <- ggplot(edu_score_suicide, aes(x = Education_Level, y = Death_Rate)) +
  geom_point() +
  geom_smooth(method = "lm", 
              se = TRUE) +
  scale_y_continuous(labels = percent) +
  labs(x = "Education Level",
       y = "Suicide Death Rate",
       title = "Education Level Score and Suicide Death Rate of 50 US States in 2017")
scatter

```

# Conclusion & Significance

__Moderate negative correlation__ is found between education attainment and suicide rate, which means that the higher the education attainment, the lower the suicide rate. Possible explanation for this result could be that people who do not drop out of school tend to have better family background, thus they are less likely to have childhood trauma (abusive parents), and are more likely to commit suicide. The result emphasizes the importance of social determinants in suicide risk. 

# Citation